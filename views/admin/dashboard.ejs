<%- include ('../../layout/adminlayout/header.ejs') %>


  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DDHKGP" height="0" width="0"
      style="display: none; visibility: hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar  ">
    <div class="layout-container">







      <!-- Menu -->

      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">


        <div class="app-brand demo ">
          <a href="index.html" class="app-brand-link">
            <a href="index.html" class="app-brand-link gap-2">

            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="menu-toggle-icon d-xl-block align-middle"></i>
            </a>
        </div>

        <div class="menu-inner-shadow"></div>



        <ul class="menu-inner py-1">
          <!-- Dashboards -->
          <li class="menu-item">



            </a>
            <ul class="menu-sub">

              </a>
          </li>

          </a>
          </li>

          </a>
          </li>
          <li class="menu-item">

            </a>
          </li>
          <li class="menu-item">

            </a>
          </li>
        </ul>
        </li>


        <li class="menu-item">

          </a>


        </li>

        <!-- Front Pages -->
        <li class="menu-item">


          </a>

        </li>



        <li class="menu-item">



          </a>
        </li>
        <!-- e-commerce-app menu start -->
        <li class="menu-item active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle">
            <i class='menu-icon tf-icons ri-shopping-bag-3-line'></i>
            <div data-i18n="woodnwonder">woodnwonder</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item active">
              <a href="/admin/dashboard" class="menu-link">
                <div data-i18n="Dashboard">Dashboard</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Products">Products</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/product" class="menu-link">
                    <div data-i18n="Product List">Product List</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/admin/addProduct" class="menu-link">
                    <div data-i18n="Add Product">Add Product</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Category">Category</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/category" class="menu-link">
                    <div data-i18n="List all category">List all category</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Order">Order</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/orders" class="menu-link">
                    <div data-i18n="Order List">Order List</div>
                  </a>
                </li>

              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Customer">Customer</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/customers" class="menu-link">
                    <div data-i18n="All Customers">All Customers</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item ">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Offers">Offers</div>
              </a>
              <ul class="menu-sub">

                <li class="menu-item ">
                  <a href="/admin/offers" class="menu-link">
                    <div data-i18n="Product Offers">Product Offers</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/admin/offers/category" class="menu-link">
                    <div data-i18n="Category Offers">Category Offers</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item ">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Coupons Management">Coupons Management</div>
              </a>
              <ul class="menu-sub">

                <li class="menu-item ">
                  <a href="/admin/coupons" class="menu-link">
                    <div data-i18n="Coupen">Coupen</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Sales Report">Sales Report</div>
              </a>
              <ul class="menu-sub">

                <li class="menu-item">
                  <a href="/admin/salesreport" class="menu-link">
                    <div data-i18n="Report">Report</div>
                  </a>
                </li>
              </ul>
            </li>

          </ul>
        </li>
        </ul>




        </a>
        <ul class="menu-sub">

    

        </ul>



      </aside>
      <!-- / Menu -->



      <!-- Layout container -->
      <div class="layout-page">





        <!-- Navbar -->

        <nav
          class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
          id="layout-navbar">












          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">


            <!-- Search -->
            <div class="navbar-nav align-items-center">
              
            </div>
            <!-- /Search -->





            <ul class="navbar-nav flex-row align-items-center ms-auto">
















              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow p-0" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="/adminassets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle">
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                  <li>
                    <a class="dropdown-item" href="pages-account-settings-account.html">
                      <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-2">
                          <div class="avatar avatar-online">
                            <img src="/adminassets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle">
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-0 small">Jinsiya</h6>
                          <small class="text-muted">Admin</small>

                        </div>
                      </div>
                    </a>
                  </li>

                  <li>
                    <a class="dropdown-item" href="pages-profile-user.html">
                      <i class="ri-user-3-line ri-22px me-2"></i>
                      <span class="align-middle">My Profile</span>
                    </a>
                  </li>





                  <li>
                    <div class="d-grid px-4 pt-2 pb-1">
                      <a class="btn btn-danger d-flex" href="/admin/logout" target="_blank">
                        <small class="align-middle">Logout</small>
                        <i class="ri-logout-box-r-line ms-2 ri-16px"></i>
                      </a>
                    </div>
                  </li>
                </ul>
              </li>




            </ul>
          </div>


          <!-- Search Small Screens -->
          <div class="navbar-search-wrapper search-input-wrapper  d-none">
            <input type="text" class="form-control search-input container-xxl border-0" placeholder="Search..."
              aria-label="Search...">
            <i class="ri-close-fill search-toggler cursor-pointer"></i>
          </div>



        </nav>

        <!-- / Navbar -->



        <!-- Content wrapper -->
        <div class="container-fluid py-4">
          <div class="row">
            <div class="col-12">
              <div class="card mb-4">
                <div class="card-header pb-0 d-flex justify-content-between align-items-center">
                  <h6>Dashboard Overview</h6>
                  <div class="form-group mb-0">
                    <label for="timeFrame" class="mr-2">Time Frame:</label>
                    <select id="timeFrame" class="form-select form-select-sm" onchange="updateDashboard()">
                      <option value="yearly" <%= timeFrame === ' yearly' ? 'selected' : '' %>>Yearly</option>
                      <option value="monthly" '<%=timeFrame ==='monthly' ? 'selected' : '' %>'>Monthly</option>
                      <option value="weekly" <%=timeFrame ==='weekly' ? 'selected' : '' %>>Weekly</option>
                      <option value="daily" <%=timeFrame==='daily' ? 'selected' : '' %>>Daily</option>
                    </select>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6 mb-4">
                      <div class="chart-container" style="position: relative; width: 344px; height: 344px;">
                        <canvas id="orderStatusChart"></canvas>
                      </div>
                    </div>
                    <div class="col-md-6 mb-4">
                      <div class="chart-container" style="position: relative; height:300px; width:100%">
                        <canvas id="salesChart"></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header pb-0">
                  <h6>Best Selling Products</h6>
                </div>
                <div class="card-body px-0 pt-0 pb-2">
                  <div class="table-responsive p-0">
                    <table class="table align-items-center mb-0">
                      <thead>
                        <tr>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Rank</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Product
                            Name</th>
                          <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                            Sales</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% bestSellingProducts.forEach((product, index)=> { %>
                          <tr>
                            <td>
                              <div class="d-flex px-2 py-1">
                                <div class="d-flex flex-column justify-content-center">
                                  <h6 class="mb-0 text-sm">
                                    <%= index + 1 %>
                                  </h6>
                                </div>
                              </div>
                            </td>
                            <td>
                              <p class="text-xs font-weight-bold mb-0">
                                <%= product.name %>
                              </p>
                            </td>
                            <td class="align-middle text-center text-sm">
                              <span class="badge badge-sm bg-gradient-success">
                                <%= product.sales %>
                              </span>
                            </td>
                          </tr>
                          <% }); %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card mb-4">
                <div class="card-header pb-0">
                  <h6>Best Selling Categories</h6>
                </div>
                <div class="card-body px-0 pt-0 pb-2">
                  <div class="table-responsive p-0">
                    <table class="table align-items-center mb-0">
                      <thead>
                        <tr>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Rank</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Category
                            Name</th>
                          <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                            Sales</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% bestSellingCategories.forEach((category, index)=> { %>
                          <tr>
                            <td>
                              <div class="d-flex px-2 py-1">
                                <div class="d-flex flex-column justify-content-center">
                                  <h6 class="mb-0 text-sm">
                                    <%= index + 1 %>
                                  </h6>
                                </div>
                              </div>
                            </td>
                            <td>
                              <p class="text-xs font-weight-bold mb-0">
                                <%= category.name %>
                              </p>
                            </td>
                            <td class="align-middle text-center text-sm">
                              <span class="badge badge-sm bg-gradient-info">
                                <%= category.sales %>
                              </span>
                            </td>
                          </tr>
                          <% }); %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Total Sales -->
        <!-- Total Revenue chart -->
        <div class="col-xl-6 col-md-3 col-sm-6">




          <script>
            document.addEventListener('DOMContentLoaded', function () {
              var dropdownElementList = [].slice.call(document.querySelectorAll('[data-bs-toggle="dropdown"]'))
              var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                return new bootstrap.Dropdown(dropdownToggleEl)
              })
            });
          </script>

          <script>
            const orderStatusData = JSON.parse('<%- JSON.stringify(orderStatusData) %>');
const salesData = JSON.parse('<%- JSON.stringify(salesData) %>');


            const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
            new Chart(orderStatusCtx, {
              type: 'doughnut',

              data: {
                labels: ['Delivered', 'Canceled', 'Returned'],
                datasets: [{
                  data: [orderStatusData.delivered, orderStatusData.canceled, orderStatusData.returned],
                  backgroundColor: [
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(255, 205, 86, 0.8)'
                  ]
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: true, 
                plugins: {
                  legend: { position: 'bottom' },
                  title: {
                    display: true,
                    text: 'Order Status Distribution'
                  }
                }
              }
            });


            const salesCtx = document.getElementById('salesChart').getContext('2d');
            new Chart(salesCtx, {
              type: 'bar',
              data: {
                labels: salesData.labels,
                datasets: [{
                  label: 'Sales',
                  data: salesData.values,
                  backgroundColor: 'rgba(255, 206, 86, 0.8)',
                  borderColor: 'rgba(255, 206, 86, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      callback: function (value) {
                        return '₹' + value.toLocaleString();
                      }
                    },
                    grid: {
                      color: 'rgba(0, 0, 0, 0.1)'
                    }
                  },
                  x: {
                    grid: {
                      display: false
                    },
                    ticks: {
                      maxRotation: 45,
                      minRotation: 45
                    }
                  }
                },
                plugins: {
                  title: {
                    display: true,
                    text: 'Sales Over Time',
                    align: 'start',
                    font: {
                      size: 16,
                      weight: 'bold'
                    }
                  },
                  legend: {
                    display: false
                  },
                  tooltip: {
                    callbacks: {
                      label: function (context) {
                        let label = context.dataset.label || '';
                        if (label) {
                          label += ': ';
                        }
                        if (context.parsed.y !== null) {
                          label += '₹' + context.parsed.y.toLocaleString();
                        }
                        return label;
                      }
                    }
                  }
                }
              }
            });

            function updateDashboard() {
              const timeFrame = document.getElementById('timeFrame').value;
              window.location.href = `/admin/dashboard?timeFrame=${timeFrame}`;
            }
          </script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


          <%- include ('../../layout/adminlayout/footer.ejs') %>